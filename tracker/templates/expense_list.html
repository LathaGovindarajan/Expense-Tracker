{% extends 'base.html' %}
{% block content %}
  <h2>Dashboard</h2>

  {# — PROFILE FORM — unchanged — #}
  <form method="post" class="mb-4">
    {% csrf_token %}
    {{ profile_form.prof.as_p }}
    <button class="btn btn-primary">Save Profile</button>
  </form>

  {% if over_all_alert %}
    <div class="alert alert-warning">
       You’ve spent {{ total }} this month, exceeding your overall threshold.
    </div>
  {% endif %}

  {# — PER-CATEGORY STATUS — #}
  <h4>Category Goals</h4>
  <table class="table table-sm mb-4">
    <thead><tr><th>Category</th><th>Goal</th><th>Spent</th><th>Alert?</th></tr></thead>
    <tbody>
      {% for c in cat_status %}
      <tr class="{% if c.alert %}table-danger{% endif %}">
        <td>{{ c.name }}</td>
        <td>{{ c.goal }}</td>
        <td>{{ c.spent }}</td>
        <td>{% if c.alert %}{% endif %}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {# — BUTTONS to go to the separate add-views — #}
  <div class="mb-4">
    <a href="{% url 'add_category' %}" class="btn btn-secondary">
      + Add Category
    </a>
    <a href="{% url 'add_expense' %}" class="btn btn-success">
      + Add Expense
    </a>
  </div>

  {# — FULL EXPENSE LIST — #}
  <h4>All Expenses</h4>
  <table class="table">
    <thead><tr><th>Amount</th><th>Category</th><th>Description</th><th>Date</th></tr></thead>
    <tbody>
      {% for e in expenses %}
      <tr>
        <td>{{ e.amount }}</td>
        <td>{{ e.category.category }}</td>
        <td>{{ e.description }}</td>
        <td>{{ e.date|date:"d-m-Y" }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock %}
